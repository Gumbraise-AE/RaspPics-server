{% extends 'base.html.twig' %}

{% block title %}Hello RaspController!{% endblock %}

{% set videoPath = "http://"~(user_ip == rasp.externIP or user_ip == "127.0.0.1" ? rasp.internIP : rasp.externIP)~":"~rasp.videoPort~"/stream.mp4" %}

{% block body %}
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.11.4/css/lightbox.css"
          integrity="sha512-Woz+DqWYJ51bpVk5Fv0yES/edIMXjj3Ynda+KWTIkGoynAMHrqTcDUQltbipuiaD5ymEo9520lyoVOo9jCQOCA=="
          crossorigin="anonymous" referrerpolicy="no-referrer"/>

    <video src="{{ videoPath }}"
           id="raspStream"
           autoplay
           muted
    ></video>

    {% for rasppic in rasp.raspPics %}
        <a href="{{ vich_uploader_asset(rasppic, 'picFile') }}" data-lightbox="picfile">
            <img src="{{ vich_uploader_asset(rasppic, 'picFile') }}" width="200">
        </a>
    {% endfor %}

    <script src="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.11.4/js/lightbox-plus-jquery.min.js"
            integrity="sha512-U9dKDqsXAE11UA9kZ0XKFyZ2gQCj+3AwZdBMni7yXSvWqLFEj8C1s7wRmWl9iyij8d5zb4wm56j4z/JVEwS77g=="
            crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script>
        let timeoutId;
        let isPassed = false;

        const element = document.getElementById('monElement');

        const pauseVideo = () => {
            clearTimeout(timeoutId);
            if (isPassed === true) {
                isPassed = false;
                raspStream.src = "{{ videoPath }}";
                raspStream.play();
            }

            timeoutId = setTimeout(function () {
                isPassed = true;
                raspStream.src = "";
            }, 3000);
        };

        document.addEventListener('mousemove', () => {
            pauseVideo()
        });

        window.onload = () => {
            pauseVideo()
        }

    </script>
{% endblock %}