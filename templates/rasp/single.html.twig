{% extends 'base.html.twig' %}

{% block title %}Hello RaspController!{% endblock %}

{% set videoPath = "http://"~(user_ip == rasp.externIP or user_ip == "127.0.0.1" ? rasp.internIP : rasp.externIP)~":"~rasp.videoPort~"/stream.mp4" %}

{% block body %}
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.11.4/js/lightbox.min.js"
            integrity="sha512-Ixzuzfxv1EqafeQlTCufWfaC6ful6WFqIz4G+dWvK0beHw0NVJwvCKSgafpy5gwNqKmgUfIBraVwkKI+Cz0SEQ=="
            crossorigin="anonymous" referrerpolicy="no-referrer"></script>

    <video src="{{ videoPath }}"
           id="raspStream"
           autoplay
           muted
    ></video>

    {% for rasppic in rasp.raspPics %}
        <a href="{{ vich_uploader_asset(rasppic, 'picFile') }}" data-lightbox="picfile">
            <img src="{{ vich_uploader_asset(rasppic, 'picFile') }}" width="200">
        </a>
    {% endfor %}

    <script
            src="https://code.jquery.com/jquery-3.6.3.slim.min.js"
            integrity="sha256-ZwqZIVdD3iXNyGHbSYdsmWP//UBokj2FHAxKuSBKDSo="
            crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.11.4/js/lightbox.min.js"
            integrity="sha512-Ixzuzfxv1EqafeQlTCufWfaC6ful6WFqIz4G+dWvK0beHw0NVJwvCKSgafpy5gwNqKmgUfIBraVwkKI+Cz0SEQ=="
            crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script>
        let timeoutId;
        let isPassed = false;

        const element = document.getElementById('monElement');

        const pauseVideo = () => {
            clearTimeout(timeoutId);
            if (isPassed === true) {
                isPassed = false;
                raspStream.src = "{{ videoPath }}";
                raspStream.play();
            }

            timeoutId = setTimeout(function () {
                isPassed = true;
                raspStream.src = "";
            }, 3000);
        };

        document.addEventListener('mousemove', () => {
            pauseVideo()
        });

        window.onload = () => {
            pauseVideo()
        }

    </script>
{% endblock %}